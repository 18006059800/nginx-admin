<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="statistics" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" whenResourceMissingType="Key" uuid="3916a44c-5f75-446d-8814-a4ba8bd5348b">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="298"/>
	<subDataset name="urls" uuid="4f42aa25-3dfc-457e-9174-24cce628433e">
		<parameter name="FROM" class="java.util.Date">
			<defaultValueExpression><![CDATA[]]></defaultValueExpression>
		</parameter>
		<parameter name="TO" class="java.util.Date">
			<defaultValueExpression><![CDATA[]]></defaultValueExpression>
		</parameter>
		<parameter name="ALIASES" class="java.lang.String">
			<defaultValueExpression><![CDATA[]]></defaultValueExpression>
		</parameter>
		<parameter name="TOTAL" class="java.lang.Long"/>
		<queryString>
			<![CDATA[select count(id) as hits,request_uri as url,server_name as host from admin.access_log where
date_time >= $P{FROM} and date_time <= $P{TO} and server_name in  ($P!{ALIASES}) group by request_uri,server_name order by hits desc]]>
		</queryString>
		<field name="HITS" class="java.lang.Long"/>
		<field name="URL" class="java.lang.String"/>
		<field name="HOST" class="java.lang.String"/>
	</subDataset>
	<subDataset name="origins" uuid="a7447336-d577-4f62-8cf5-e63a9c5d44ca">
		<parameter name="FROM" class="java.util.Date"/>
		<parameter name="TO" class="java.util.Date"/>
		<parameter name="ALIASES" class="java.lang.String"/>
		<parameter name="TOTAL" class="java.lang.Long"/>
		<queryString>
			<![CDATA[select count(id) as hits,remote_addr as ip from admin.access_log where
date_time >= $P{FROM} and date_time <= $P{TO} and server_name in  ($P!{ALIASES}) group by remote_addr order by hits desc]]>
		</queryString>
		<field name="HITS" class="java.lang.Long"/>
		<field name="IP" class="java.lang.String"/>
	</subDataset>
	<parameter name="LOGO" class="java.lang.Object" isForPrompting="false"/>
	<parameter name="FROM" class="java.util.Date"/>
	<parameter name="TO" class="java.util.Date"/>
	<parameter name="ALIASES" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[select count(id) as hits from admin.access_log where
date_time >= $P{FROM} and date_time <= $P{TO} and server_name in  ($P!{ALIASES})]]>
	</queryString>
	<field name="HITS" class="java.lang.Long"/>
	<variable name="FROM" class="java.lang.String">
		<variableExpression><![CDATA[($P{FROM} != null ? " and " : "")]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="298" splitType="Stretch">
			<image>
				<reportElement x="0" y="0" width="150" height="144" uuid="a5d32b79-372f-4c86-9932-be6821900434"/>
				<imageExpression><![CDATA[$P{LOGO}]]></imageExpression>
			</image>
			<staticText>
				<reportElement x="150" y="0" width="405" height="144" uuid="94df7f6d-7f6e-4438-906a-5dbc64325f64"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="24" isBold="true" isItalic="true"/>
				</textElement>
				<text><![CDATA[Statistics report]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" x="0" y="268" width="100" height="20" uuid="8dbe9376-8e28-4269-892f-5ddfb38b8b61"/>
				<textElement>
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Total requests :]]></text>
			</staticText>
			<textField>
				<reportElement positionType="Float" x="100" y="268" width="285" height="20" uuid="47c60cb6-8f4d-41bc-979a-42f6429e219b"/>
				<textElement>
					<font size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{HITS}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="188" width="100" height="20" uuid="6c594214-4943-46a4-a4f9-b2e8c8f710cf"/>
				<textElement>
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[From :]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy HH:mm">
				<reportElement x="100" y="188" width="285" height="20" uuid="bf2ddb40-f343-4c2c-83b9-2811bceb6e18"/>
				<textElement>
					<font size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{FROM}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="208" width="100" height="20" uuid="206cd99f-43bd-4eb4-8ee1-24dc3d2700e5"/>
				<textElement>
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[To :]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy HH:mm">
				<reportElement x="100" y="208" width="285" height="20" uuid="f37bcd2e-8a9f-43b6-b87a-d9b66fd5b53d"/>
				<textElement>
					<font size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{TO}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="228" width="100" height="20" uuid="aee215fc-d6c9-4dd3-9a42-73e9423a17c4"/>
				<textElement>
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Virtual hosts :]]></text>
			</staticText>
			<textField isStretchWithOverflow="true">
				<reportElement x="0" y="248" width="385" height="20" uuid="ea8f38ca-067d-4d99-87ef-fbc73088c575"/>
				<textElement>
					<font size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{ALIASES}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="157" width="555" height="20" uuid="538b4537-6ea6-46e1-8d08-9d7c45ba72e1"/>
				<textElement textAlignment="Center">
					<font size="14" isBold="true" isItalic="true"/>
				</textElement>
				<text><![CDATA[Filters]]></text>
			</staticText>
		</band>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band splitType="Stretch"/>
	</columnHeader>
	<detail>
		<band height="760" splitType="Stretch">
			<componentElement>
				<reportElement x="0" y="55" width="555" height="29" uuid="56169595-b0f1-4bea-b314-7320527594e4"/>
				<jr:list xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd" printOrder="Vertical">
					<datasetRun subDataset="urls" uuid="101bd08d-d3bb-4b64-9dee-2edf644e2b16">
						<datasetParameter name="FROM">
							<datasetParameterExpression><![CDATA[$P{FROM}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="TO">
							<datasetParameterExpression><![CDATA[$P{TO}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="ALIASES">
							<datasetParameterExpression><![CDATA[$P{ALIASES}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="TOTAL">
							<datasetParameterExpression><![CDATA[$F{HITS}]]></datasetParameterExpression>
						</datasetParameter>
						<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
					</datasetRun>
					<jr:listContents height="29" width="555">
						<textField>
							<reportElement x="0" y="5" width="57" height="20" uuid="fa80c537-5030-45a1-ba05-0ee26f3d9516"/>
							<textElement textAlignment="Center">
								<font size="12"/>
							</textElement>
							<textFieldExpression><![CDATA[$F{HITS}]]></textFieldExpression>
						</textField>
						<textField isStretchWithOverflow="true">
							<reportElement x="108" y="5" width="295" height="20" uuid="73edfd53-e6b0-4c79-b939-0fa7d6a95531"/>
							<textElement>
								<font size="12"/>
							</textElement>
							<textFieldExpression><![CDATA[$F{URL}]]></textFieldExpression>
						</textField>
						<textField>
							<reportElement x="403" y="5" width="152" height="20" uuid="c11b0028-1b87-4307-9fc9-bb4c42a60a96"/>
							<textElement>
								<font size="12"/>
							</textElement>
							<textFieldExpression><![CDATA[$F{HOST}]]></textFieldExpression>
						</textField>
						<textField pattern="">
							<reportElement x="57" y="5" width="51" height="20" uuid="b16476d7-1ba2-49ca-937f-14bb0f806396"/>
							<textElement textAlignment="Center">
								<font size="12"/>
							</textElement>
							<textFieldExpression><![CDATA[new java.math.BigDecimal($F{HITS}).multiply(new java.math.BigDecimal(100)).divide(new java.math.BigDecimal($P{TOTAL}),2, java.math.RoundingMode.HALF_UP)]]></textFieldExpression>
						</textField>
						<line>
							<reportElement positionType="Float" x="0" y="0" width="555" height="1" uuid="6d2d1543-049d-4d00-8ba4-4821aa714fd7"/>
						</line>
					</jr:listContents>
				</jr:list>
			</componentElement>
			<staticText>
				<reportElement x="0" y="35" width="57" height="20" uuid="98c9663d-a7f3-4a05-a31e-245b4fd774ab"/>
				<textElement textAlignment="Center">
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[HITS]]></text>
			</staticText>
			<staticText>
				<reportElement x="57" y="35" width="51" height="20" uuid="65b9c992-3904-4165-baf2-7a0315858beb"/>
				<textElement textAlignment="Center">
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[%]]></text>
			</staticText>
			<staticText>
				<reportElement x="108" y="35" width="295" height="20" uuid="5102420d-b32e-4abf-9553-8d3a0595f750"/>
				<textElement textAlignment="Center">
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[URL]]></text>
			</staticText>
			<staticText>
				<reportElement x="403" y="35" width="152" height="20" uuid="af11155d-131a-46ba-9b54-0de103caa120"/>
				<textElement textAlignment="Center">
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[HOST]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="0" width="555" height="20" uuid="4f9c825f-fc1f-4150-adf1-989d5e1e43b4"/>
				<textElement textAlignment="Center">
					<font size="14" isBold="true" isItalic="true"/>
				</textElement>
				<text><![CDATA[Requested URLs]]></text>
			</staticText>
			<componentElement>
				<reportElement positionType="Float" x="0" y="151" width="555" height="29" uuid="aff4ef60-a541-4ac4-afb9-601418930524"/>
				<jr:list xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd">
					<datasetRun subDataset="origins" uuid="30dcd1cc-9cbc-491a-8187-df84965d327e">
						<datasetParameter name="FROM">
							<datasetParameterExpression><![CDATA[$P{FROM}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="TO">
							<datasetParameterExpression><![CDATA[$P{TO}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="TOTAL">
							<datasetParameterExpression><![CDATA[$F{HITS}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="ALIASES">
							<datasetParameterExpression><![CDATA[$P{ALIASES}]]></datasetParameterExpression>
						</datasetParameter>
						<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
					</datasetRun>
					<jr:listContents height="29" width="555">
						<textField>
							<reportElement x="0" y="5" width="54" height="20" uuid="d1541afe-a068-41de-b31d-c0d42629a4d7"/>
							<textElement textAlignment="Center">
								<font size="12"/>
							</textElement>
							<textFieldExpression><![CDATA[$F{HITS}]]></textFieldExpression>
						</textField>
						<textField>
							<reportElement x="105" y="5" width="450" height="20" uuid="72f2f09c-4a64-494d-8c00-9d5d6c0ebb2f"/>
							<textElement>
								<font size="12"/>
							</textElement>
							<textFieldExpression><![CDATA[$F{IP}]]></textFieldExpression>
						</textField>
						<textField>
							<reportElement x="54" y="5" width="51" height="20" uuid="89c2a041-1806-437b-9a8b-6adc68514d1c"/>
							<textElement textAlignment="Center">
								<font size="12"/>
							</textElement>
							<textFieldExpression><![CDATA[new java.math.BigDecimal($F{HITS}).multiply(new java.math.BigDecimal(100)).divide(new java.math.BigDecimal($P{TOTAL}),2, java.math.RoundingMode.HALF_UP)]]></textFieldExpression>
						</textField>
						<line>
							<reportElement x="0" y="0" width="552" height="1" uuid="18a900cd-e2f3-4ff1-bb85-f2c75600d694"/>
						</line>
					</jr:listContents>
				</jr:list>
			</componentElement>
			<staticText>
				<reportElement positionType="Float" x="0" y="105" width="555" height="20" uuid="c880c292-de5f-4fa9-b75b-4e53da53641d"/>
				<textElement textAlignment="Center">
					<font size="14" isBold="true" isItalic="true"/>
				</textElement>
				<text><![CDATA[Origins IP access]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" x="105" y="131" width="450" height="20" uuid="61133e15-3a42-43b0-9c63-c43fa2c0d9d7"/>
				<textElement textAlignment="Center">
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[IP]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" x="0" y="131" width="54" height="20" uuid="c6d69290-4880-44ce-98b7-b1f82312ce02"/>
				<textElement textAlignment="Center">
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[HITS]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" x="54" y="131" width="51" height="20" uuid="30cbad82-5c68-48a9-9c0c-bb839bb32193"/>
				<textElement textAlignment="Center">
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[%]]></text>
			</staticText>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="42" splitType="Stretch">
			<textField>
				<reportElement x="429" y="10" width="80" height="20" uuid="c782bb32-e63e-4d9a-8fe5-e3dc6ecfc06a"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA["Page "+$V{PAGE_NUMBER}+" of"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="509" y="10" width="40" height="20" uuid="32394ce7-bc4f-4954-8f31-3a6f61d31fb6"/>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band splitType="Stretch"/>
	</summary>
</jasperReport>
